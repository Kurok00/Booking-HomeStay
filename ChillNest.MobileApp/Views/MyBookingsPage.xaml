<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ChillNest.MobileApp.ViewModels"
             xmlns:models="clr-namespace:ChillNest.MobileApp.Models"
             x:Class="ChillNest.MobileApp.Views.MyBookingsPage"
             x:DataType="viewmodels:MyBookingsViewModel"
             Title=""
             BackgroundColor="#F8F9FA">

    <Grid RowDefinitions="Auto,*">
        <!-- Modern Header with Gradient -->
        <Grid Grid.Row="0" RowDefinitions="Auto,Auto" Padding="0">
            <!-- Gradient Background -->
            <BoxView Grid.RowSpan="2">
                <BoxView.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#667eea" Offset="0.0"/>
                        <GradientStop Color="#764ba2" Offset="1.0"/>
                    </LinearGradientBrush>
                </BoxView.Background>
            </BoxView>
            
            <!-- Header Content -->
            <VerticalStackLayout Grid.Row="0" Padding="24,20,24,16" Spacing="8">
                <Label Text="My Trips"
                       FontSize="32"
                       FontAttributes="Bold"
                       TextColor="White"/>
                <Label Text="Track and manage your bookings"
                       FontSize="15"
                       TextColor="White"
                       Opacity="0.85"/>
            </VerticalStackLayout>
            
            <!-- Wave Shape Bottom -->
            <BoxView Grid.Row="1" HeightRequest="20" BackgroundColor="#F8F9FA">
                <BoxView.Clip>
                    <EllipseGeometry Center="200,0" RadiusX="250" RadiusY="30"/>
                </BoxView.Clip>
            </BoxView>
        </Grid>

        <!-- Content with Pull-to-Refresh -->
        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}"
                     RefreshColor="#667eea">
            <ScrollView>
                <VerticalStackLayout Padding="16,8" Spacing="16">
                    
                    <!-- Loading Indicator -->
                    <VerticalStackLayout IsVisible="{Binding IsLoading}" Padding="0,40" Spacing="16" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="True"
                                         Color="#667eea"
                                         WidthRequest="40"
                                         HeightRequest="40"/>
                        <Label Text="Loading your trips..."
                               FontSize="14"
                               TextColor="#666"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>

                    <!-- Error Message -->
                    <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotEmptyConverter}}"
                            BackgroundColor="#FFF3F3"
                            StrokeShape="RoundRectangle 16"
                            Stroke="#FFD6D6"
                            StrokeThickness="1"
                            Padding="16"
                            Margin="0,8">
                        <HorizontalStackLayout Spacing="12">
                            <Label Text="⚠️" FontSize="20" VerticalOptions="Center"/>
                            <Label Text="{Binding ErrorMessage}"
                                   TextColor="#D32F2F"
                                   FontSize="14"
                                   VerticalOptions="Center"
                                   LineBreakMode="WordWrap"
                                   HorizontalOptions="FillAndExpand"/>
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Empty State - Modern Design -->
                    <VerticalStackLayout IsVisible="{Binding HasBookings, Converter={StaticResource InvertedBoolConverter}}"
                                       Spacing="20"
                                       Padding="32,60"
                                       VerticalOptions="CenterAndExpand">
                        <!-- Empty Icon -->
                        <Border BackgroundColor="#F0F0FF"
                               StrokeShape="RoundRectangle 60"
                               StrokeThickness="0"
                               WidthRequest="120"
                               HeightRequest="120"
                               HorizontalOptions="Center">
                            <Label Text="🏖️"
                                   FontSize="64"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
                        </Border>
                        
                        <Label Text="No trips yet"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="#2D3142"/>
                        <Label Text="Ready to explore the world?"
                               FontSize="16"
                               TextColor="#666"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                        <Label Text="Browse hotels and create your first booking to start your journey!"
                               FontSize="14"
                               TextColor="#999"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               Margin="0,0,0,20"/>
                        
                        <!-- Call-to-Action Button -->
                        <Border BackgroundColor="#667eea"
                               StrokeShape="RoundRectangle 25"
                               StrokeThickness="0"
                               Padding="32,14"
                               HorizontalOptions="Center">
                            <Border.Shadow>
                                <Shadow Brush="#667eea" Opacity="0.3" Radius="15" Offset="0,5"/>
                            </Border.Shadow>
                            <Label Text="🔍 Explore Hotels"
                                   TextColor="White"
                                   FontSize="16"
                                   FontAttributes="Bold"/>
                        </Border>
                    </VerticalStackLayout>

                    <!-- Bookings List - Beautiful Card Design -->
                    <VerticalStackLayout IsVisible="{Binding HasBookings}"
                                        Spacing="16"
                                        BindableLayout.ItemsSource="{Binding Bookings}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate x:DataType="models:BookingItem">
                                <Border BackgroundColor="White"
                                       StrokeShape="RoundRectangle 20"
                                       StrokeThickness="0"
                                       Padding="0"
                                       Margin="0">
                                    <Border.Shadow>
                                        <Shadow Brush="Black" Opacity="0.08" Radius="20" Offset="0,4"/>
                                    </Border.Shadow>
                                    
                                    <Grid RowDefinitions="200,Auto" RowSpacing="0">
                                        
                                        <!-- Hero Image Section with Status Badge -->
                                        <Grid Grid.Row="0">
                                            <!-- Room Photo -->
                                            <Border StrokeShape="RoundRectangle 20,20,0,0"
                                                  StrokeThickness="0"
                                                  HeightRequest="200">
                                                <Image Source="{Binding RoomPhoto}"
                                                     Aspect="AspectFill"/>
                                            </Border>
                                            
                                            <!-- Gradient Overlay -->
                                            <BoxView Color="#000000"
                                                   Opacity="0.25"
                                                   VerticalOptions="Start"
                                                   HeightRequest="80"/>
                                            
                                            <!-- Status Badge -->
                                            <Border BackgroundColor="{Binding StatusColor}"
                                                  StrokeShape="RoundRectangle 20"
                                                  StrokeThickness="0"
                                                  Padding="16,8"
                                                  Margin="16"
                                                  HorizontalOptions="End"
                                                  VerticalOptions="Start">
                                                <Border.Shadow>
                                                    <Shadow Brush="Black" Opacity="0.3" Radius="8" Offset="0,2"/>
                                                </Border.Shadow>
                                                <Label Text="{Binding StatusString}"
                                                     TextColor="White"
                                                     FontSize="13"
                                                     FontAttributes="Bold"/>
                                            </Border>
                                        </Grid>

                                        <!-- Card Content -->
                                        <VerticalStackLayout Grid.Row="1" Padding="20,16,20,20" Spacing="14">
                                            
                                            <!-- Hotel Name -->
                                            <Label Text="{Binding HotelName}"
                                                 FontSize="22"
                                                 FontAttributes="Bold"
                                                 TextColor="#2D3142"
                                                 LineBreakMode="TailTruncation"
                                                 MaxLines="2"/>
                                            
                                            <!-- Room Name -->
                                            <HorizontalStackLayout Spacing="10">
                                                <Label Text="🛏️" FontSize="18" VerticalOptions="Center"/>
                                                <Label Text="{Binding RoomName}"
                                                     FontSize="16"
                                                     TextColor="#555"
                                                     VerticalOptions="Center"
                                                     LineBreakMode="TailTruncation"
                                                     HorizontalOptions="FillAndExpand"/>
                                            </HorizontalStackLayout>

                                            <!-- Divider -->
                                            <BoxView Color="#E8E8E8" HeightRequest="1" Margin="0,6"/>

                                            <!-- Date Grid -->
                                            <Grid ColumnDefinitions="*,Auto,*" ColumnSpacing="16">
                                                <!-- Check-in -->
                                                <VerticalStackLayout Grid.Column="0" Spacing="6">
                                                    <Label Text="📅 Check-in"
                                                         FontSize="12"
                                                         TextColor="#999"
                                                         FontAttributes="Bold"/>
                                                    <Label Text="{Binding CheckIn, StringFormat='{0:MMM dd}'}"
                                                         FontSize="16"
                                                         FontAttributes="Bold"
                                                         TextColor="#2D3142"/>
                                                    <Label Text="{Binding CheckIn, StringFormat='{0:yyyy}'}"
                                                         FontSize="12"
                                                         TextColor="#666"/>
                                                </VerticalStackLayout>
                                                
                                                <!-- Arrow Icon -->
                                                <Label Grid.Column="1"
                                                     Text="→"
                                                     FontSize="24"
                                                     TextColor="#667eea"
                                                     VerticalOptions="Center"/>
                                                
                                                <!-- Check-out -->
                                                <VerticalStackLayout Grid.Column="2" Spacing="6">
                                                    <Label Text="📅 Check-out"
                                                         FontSize="12"
                                                         TextColor="#999"
                                                         FontAttributes="Bold"/>
                                                    <Label Text="{Binding CheckOut, StringFormat='{0:MMM dd}'}"
                                                         FontSize="16"
                                                         FontAttributes="Bold"
                                                         TextColor="#2D3142"/>
                                                    <Label Text="{Binding CheckOut, StringFormat='{0:yyyy}'}"
                                                         FontSize="12"
                                                         TextColor="#666"/>
                                                </VerticalStackLayout>
                                            </Grid>

                                            <!-- Nights Display -->
                                            <HorizontalStackLayout Spacing="10" Margin="0,4,0,0">
                                                <Label Text="🌙" FontSize="16" VerticalOptions="Center"/>
                                                <Label Text="{Binding NightsDisplay}"
                                                     FontSize="14"
                                                     TextColor="#667eea"
                                                     FontAttributes="Bold"
                                                     VerticalOptions="Center"/>
                                            </HorizontalStackLayout>

                                            <!-- Price Section -->
                                            <Border BackgroundColor="#F0F4FF"
                                                  StrokeShape="RoundRectangle 16"
                                                  StrokeThickness="0"
                                                  Padding="16,14"
                                                  Margin="0,8,0,8">
                                                <HorizontalStackLayout Spacing="12">
                                                    <Label Text="💰" FontSize="24" VerticalOptions="Center"/>
                                                    <VerticalStackLayout Spacing="2" VerticalOptions="Center">
                                                        <Label Text="Total Price"
                                                             FontSize="12"
                                                             TextColor="#666"/>
                                                        <Label Text="{Binding TotalDisplay}"
                                                             FontSize="26"
                                                             FontAttributes="Bold"
                                                             TextColor="#667eea"/>
                                                    </VerticalStackLayout>
                                                </HorizontalStackLayout>
                                            </Border>

                                            <!-- Action Buttons -->
                                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12" Margin="0,4,0,0">
                                                <!-- View Details Button -->
                                                <Border Grid.Column="0"
                                                      BackgroundColor="#667eea"
                                                      StrokeShape="RoundRectangle 14"
                                                      StrokeThickness="0"
                                                      Padding="0,16">
                                                    <Border.Shadow>
                                                        <Shadow Brush="#667eea" Opacity="0.35" Radius="12" Offset="0,4"/>
                                                    </Border.Shadow>
                                                    <Label Text="📋 View Details"
                                                         TextColor="White"
                                                         FontSize="16"
                                                         FontAttributes="Bold"
                                                         HorizontalOptions="Center"
                                                         VerticalOptions="Center"/>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer 
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MyBookingsViewModel}}, Path=ViewDetailsCommand}"
                                                            CommandParameter="{Binding .}"/>
                                                    </Border.GestureRecognizers>
                                                </Border>

                                                <!-- Cancel Button -->
                                                <Border Grid.Column="1"
                                                      IsVisible="{Binding CanCancel}"
                                                      BackgroundColor="#FFE8E8"
                                                      StrokeShape="RoundRectangle 14"
                                                      StrokeThickness="0"
                                                      Padding="16"
                                                      WidthRequest="56"
                                                      HeightRequest="56">
                                                    <Label Text="❌"
                                                         FontSize="24"
                                                         HorizontalOptions="Center"
                                                         VerticalOptions="Center"/>
                                                    <Border.GestureRecognizers>
                                                        <TapGestureRecognizer 
                                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MyBookingsViewModel}}, Path=CancelBookingCommand}"
                                                            CommandParameter="{Binding .}"/>
                                                    </Border.GestureRecognizers>
                                                </Border>
                                            </Grid>

                                        </VerticalStackLayout>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>

                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
    </Grid>
</ContentPage>
